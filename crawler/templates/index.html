<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Publications</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div id="app" class="container mt-5">
        <h1 class="mb-4">Search Publications</h1>
        <form @submit.prevent="search" class="mb-4">
            <div class="mb-3">
                <label for="searchQuery" class="form-label">Search:</label>
                <input type="text" v-model="searchQuery" id="searchQuery" class="form-control" required placeholder="Enter your search query">
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
        <b-table striped hover :items="searchResults" :fields="fields">
            <template v-slot:cell(publication_url)="row">
                <a v-if="row.item.publication_url!='N/A'" :href="row.item.publication_url" target="_blank">{{ row.item.publication_url }}</a>
                <span v-else>{{ row.item.publication_url }}</span>
            </template>
            <template v-slot:cell(author_profile_url)="row">
                <a v-if="row.item.author_profile_url!='N/A'"  :href="row.item.author_profile_url" target="_blank">{{ row.item.author_profile_url }}</a>
                <span v-else>{{ row.item.author_profile_url }}</span>
            </template>
        </b-table>

    </div>
    <!-- Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-vue@2.21.2/dist/bootstrap-vue.min.js"></script>

    <script>

        Vue.component('b-table', BootstrapVue.bTable);

        new Vue({
            el: '#app',
            data: {
                searchQuery: '',
                searchResults: [],
                fields: [
                    { key: 'title', label: 'Title', tdClass: 'col-width-30' },
                    { key: 'authors', label: 'Authors', tdClass: 'col-width-15' },
                    { key: 'year', label: 'Year', tdClass: 'col-width-10' },
                    { key: 'publication_url', label: 'Publication URL', tdClass: 'col-width-20' },
                    { key: 'author_profile_url', label: 'Author Profile URL', tdClass: 'col-width-25' }
            ]
            },
            methods: {
                search() {
                    fetch(`/search?query=${encodeURIComponent(this.searchQuery)}`)
                        .then(response => response.json())
                        .then(data => {
                            this.searchResults = data;
                        })
                        .catch(error => {
                            console.error('Error fetching search results:', error);
                        });
                }
            }
        });
    </script>
        <style>
            .col-width-10 { width: 10%; }
            .col-width-15 { width: 15%; }
            .col-width-20 { width: 20%; }
            .col-width-25 { width: 25%; }
            .col-width-30 { width: 30%; }

</style>
</body>
</html>
